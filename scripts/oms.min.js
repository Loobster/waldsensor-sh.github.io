/*!
 * OverlappingMarkerSpiderfier-Leaflet
 * https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet
 */
(function(){var c,f,g,h,e,d=[].slice;b=function(a,b){this.marker=a;this.markerSpiderfier=b};b.prototype={marker:null,markerSpiderfier:null,leg:null,ignore:!1};e=function(a,b){return function(){return a.apply(b,arguments)}};h=function(a,b,c){if(null==b)return a;for(var d in b)!b.hasOwnProperty(d)||c&&a[d]!==void 0||(a[d]=b[d]);return a};f=function(){function a(b){this.map=b;this.init()}a.prototype={map:null,markers:[],spiderfied:!1,nearbyDistance:20,footSeparation:25,legWeight:1,legColors:{usual:"#222",highlighted:"#f00"},circleSpiralSwitchover:9,spiralFootSeparation:26,spiralLengthStart:11,spiralLengthFactor:5,circleFootSeparation:25,circleStartAngle:0,ignoreMapClick:!1,init:function(){var a=this;this.listeners={},this.markerListenerRefs=[],this.spiderListenerRefs=[],this.map.on("click",function(){return!a.ignoreMapClick&&a.unspiderfy()})},addMarker:function(a){var c=this;if(-1!==this.markers.indexOf(a))return this;a.on("click",function(b){return c.spiderListenerRefs.length?(c.spiderListenerRefs.forEach(function(b){return b.remove()}),c.spiderListenerRefs=[],void 0):(c.spiderfied?c.unspiderfy():c.spiderfy(a),b.originalEvent&&b.originalEvent.stopPropagation())}),this.markers.push(a);return this},getNearbyMarkers:function(a){var b=this;a=a.getLatLng();return this.markers.filter(function(c){return c!==a&&b.distance(a,c.getLatLng())<b.nearbyDistance})},spiderfy:function(a){var c,d,e,b,f,g,j,h,i,k,l,m,n;this.spiderfied&&this.unspiderfy();f=this.getNearbyMarkers(a);f.push(a);if(!(f.length>=2))return;this.spiderfied=!0;g=this.twoPi/f.length;j=this.circleFootSeparation;h=this.circleStartAngle;m=[];for(n=0,l=f.length;n<l;n++)c=f[n],i=h+g*n,d=this.ptDistance(j*Math.cos(i),j*Math.sin(i)),k=new L.LatLng(a.getLatLng().lat+d.y,a.getLatLng().lng+d.x),e=new L.Polyline([c.getLatLng(),k],{weight:this.legWeight,color:this.legColors.usual}),this.map.addLayer(e),c.setLatLng(k),m.push(e);this.spiderListenerRefs=m},unspiderfy:function(){var a,b,c,d;if(!this.spiderfied)return this;this.spiderfied=!1;for(c=0,d=this.spiderListenerRefs.length;c<d;c++)a=this.spiderListenerRefs[c],this.map.removeLayer(a);this.spiderListenerRefs=[];return this},ptDistance:function(a,b){var c,d;c=6378137;d=Math.PI/180;return{x:a/(c*d),y:b/(c*d)}},distance:function(a,b){var c,d,e,f;c=a.lat*d;d=b.lat*d;e=(b.lat-a.lat)*d;f=(b.lng-a.lng)*d;return 2*c*Math.asin(Math.sqrt(Math.sin(e/2)*Math.sin(e/2)+Math.cos(c)*Math.cos(d)*Math.sin(f/2)*Math.sin(f/2)))}};
return a}();"undefined"!==typeof exports?module.exports=f:"undefined"!==typeof window&&(window.OverlappingMarkerSpiderfier=f)}).call(this);
