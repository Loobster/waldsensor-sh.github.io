<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>WALDSENSOR.SH â€“ v0.19</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map { height: 100vh; }
  </style>
</head>
<body>
<div id="map"></div>
<script>
  var map = L.map('map').setView([54.322, 9.662], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap-Mitwirkende'
  }).addTo(map);

  var popupContent = `
    <h4>ğŸ“ Schulwald Schacht-Audorf</h4>
    <b>Mikroklima-Vergleich</b><br>
    <ul>
      <li><b>Luft:</b> Temperatur: <span id="temp_luft"></span>â€¯Â°C &nbsp;&nbsp; Feuchte: <span id="hum_luft"></span>%</li>
      <li><b>Boden:</b> Temperatur: <span id="temp_boden"></span>â€¯Â°C &nbsp;&nbsp; Feuchte: <span id="hum_boden"></span>%</li>
      <li><b>Blatt:</b> Temperatur: <span id="temp_blatt"></span>â€¯Â°C &nbsp;&nbsp; Feuchte: <span id="hum_blatt"></span>%</li>
    </ul>
    <small><i>Live-Daten aus drei Sensoren</i></small>
  `;

  L.marker([54.322, 9.662]).addTo(map).bindPopup(popupContent).on('popupopen', function() {
    fetch('data/v2/latest/s31-lb.json')
      .then(response => response.json())
      .then(data => {
        document.getElementById('temp_luft').textContent = data.TempC_SHT31?.toFixed(1) || '-';
        document.getElementById('hum_luft').textContent = data.Hum_SHT31?.toFixed(1) || '-';
      });

    fetch('data/v2/latest/se01-lb.json')
      .then(response => response.json())
      .then(data => {
        document.getElementById('temp_boden').textContent = data.temp_SOIL?.toFixed(1) || '-';
        document.getElementById('hum_boden').textContent = data.water_SOIL?.toFixed(1) || '-';
      });

    fetch('data/v2/latest/llms01.json')
      .then(response => response.json())
      .then(data => {
        document.getElementById('temp_blatt').textContent = data.Leaf_Temperature?.toFixed(1) || '-';
        document.getElementById('hum_blatt').textContent = data.Leaf_Moisture?.toFixed(1) || '-';
      });
  });
</script>
</body>
</html>
